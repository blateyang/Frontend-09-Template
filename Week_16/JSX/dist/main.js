(()=>{"use strict";function t(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),n&&e(t,n)}function e(t,n){return(e=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,n)}function n(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,o=i(t);if(e){var a=i(this).constructor;n=Reflect.construct(o,arguments,a)}else n=o.apply(this,arguments);return r(this,n)}}function r(t,e){return!e||"object"!==s(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function i(t){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function c(t,e,n){return e&&a(t.prototype,e),n&&a(t,n),t}function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function u(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return l(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,c=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){c=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(c)throw o}}}}function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var f=Symbol("state"),h=Symbol("attribute"),p=function(){function t(e){o(this,t),this[h]=Object.create(null),this[f]=Object.create(null)}return c(t,[{key:"render",value:function(){return this.root}},{key:"setAttribute",value:function(t,e){this[h][t]=e}},{key:"appendChild",value:function(t){t.mountTo(this.root)}},{key:"mountTo",value:function(t){this.root||this.render(),t.appendChild(this.root)}},{key:"triggerEvent",value:function(t,e){this[h]["on"+t.replace(/^[\s\S]/,(function(t){return t.toUpperCase()}))](new CustomEvent(t,{detail:e}))}}]),t}(),d=function(e){t(i,e);var r=n(i);function i(t){var e;return o(this,i),(e=r.call(this)).root=document.createElement(t),e}return c(i,[{key:"setAttribute",value:function(t,e){this.root.setAttribute(t,e)}}]),i}(p),y=function(e){t(i,e);var r=n(i);function i(t){var e;return o(this,i),(e=r.call(this)).root=document.createTextNode(t),e}return i}(p);function v(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return m(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?m(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,c=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){c=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(c)throw o}}}}function m(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function b(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function g(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function w(t,e,n){return e&&g(t.prototype,e),n&&g(t,n),t}var T=function(){function t(e){b(this,t),this.element=e}return w(t,[{key:"dispatch",value:function(t,e){var n=new Event(t);for(var r in e)n[r]=e[r];this.element.dispatchEvent(n)}}]),t}(),S=function t(e,n){b(this,t),this.element=e;var r=new Map,i=!1;e.addEventListener("mousedown",(function(t){var e=Object.create(null);r.set("mouse"+(1<<t.button),e),n.start(t,e);var o=function(t){for(var e=1;e<=t.buttons;){var i;i=2===e?4:4===e?2:e,e&t.buttons&&n.move(t,r.get("mouse"+i)),e<<=1}};i||(document.addEventListener("mousemove",o),document.addEventListener("mouseup",(function t(e){n.end(e,r.get("mouse"+(1<<e.button))),r.delete(r.get("mouse"+(1<<e.button))),0===e.buttons&&(document.removeEventListener("mousemove",o),document.removeEventListener("mouseup",t),i=!1)})),i=!0)})),e.addEventListener("touchstart",(function(t){var e,i=v(t.changedTouches);try{for(i.s();!(e=i.n()).done;){var o=e.value,a=Object.create(null);r.set(o.identifier,a),n.start(o,a)}}catch(t){i.e(t)}finally{i.f()}})),e.addEventListener("touchmove",(function(t){var e,i=v(t.changedTouches);try{for(i.s();!(e=i.n()).done;){var o=e.value;n.move(o,r.get(o.identifier))}}catch(t){i.e(t)}finally{i.f()}})),e.addEventListener("touchend",(function(t){var e,i=v(t.changedTouches);try{for(i.s();!(e=i.n()).done;){var o=e.value;n.end(o,r.get(o.identifier)),r.delete(o.identifier)}}catch(t){i.e(t)}finally{i.f()}})),e.addEventListener("touchcancel",(function(t){var e,i=v(t.changedTouches);try{for(i.s();!(e=i.n()).done;){var o=e.value;n.cancel(o,r.get(o.identifier)),r.delete(o.identifier)}}catch(t){i.e(t)}finally{i.f()}}))},k=function(){function t(e){b(this,t),this.dispatcher=e}return w(t,[{key:"start",value:function(t,e){var n=this;e.startX=t.clientX,e.startY=t.clientY,this.dispatcher.dispatch("start",{clientX:t.clientX,clientY:t.clientY}),e.startTime=Date.now(),e.isTap=!0,e.isPress=!1,e.isPan=!1,e.isFlick=!1,e.handler=setTimeout((function(){e.isPress=!0,e.isTap=!1,e.isPan=!1,n.dispatcher.dispatch("press",{startTime:e.startTime,clientX:t.clientX,clientY:t.clientY})}),500),e.points=[{time:Date.now(),pointX:t.clientX,pointY:t.clientY}]}},{key:"move",value:function(t,e){var n=t.clientX-e.startX,r=t.clientY-e.startY;!e.isPan&&Math.pow(n,2)+Math.pow(r,2)>100&&(clearTimeout(e.handler),e.isPan=!0,e.isTap=!1,e.isPress=!1,e.handler=null,e.isVertical=Math.abs(r)>Math.abs(n),console.log("panstart"),this.dispatcher.dispatch("panstart",{startTime:e.startTime,startX:e.startX,startY:e.startY,clientX:t.clientX,clientY:t.clientY,isVertical:e.isVertical})),e.isPan&&this.dispatcher.dispatch("pan",{startTime:e.startTime,startX:e.startX,startY:e.startY,clientX:t.clientX,clientY:t.clientY,isVertical:e.isVertical}),e.points=e.points.filter((function(t){return Date.now()-t.time<500})),e.points.push({time:Date.now(),pointX:t.clientX,pointY:t.clientY})}},{key:"end",value:function(t,e){clearTimeout(e.handler),e.isTap&&this.dispatcher.dispatch("tap",{}),e.isPress&&this.dispatcher.dispatch("pressend",{duration:Date.now()-e.startTime});var n=Math.sqrt(Math.pow(t.clientX-e.points[0].pointX,2)+Math.pow(t.clientY-e.points[0].pointY,2))/(Date.now()-e.points[0].time);n>1.5?(e.isFlick=!0,this.dispatcher.dispatch("flick",{startTime:e.startTime,startX:e.startX,startY:e.startY,clientX:t.clientX,clientY:t.clientY,isFlick:e.isFlick,velocity:n})):e.isFlick=!1,e.isPan&&this.dispatcher.dispatch("panend",{startTime:e.startTime,startX:e.startX,startY:e.startY,clientX:t.clientX,clientY:t.clientY,isFlick:e.isFlick,isVertical:e.isVertical,velocity:n}),e.isTap=!1,e.isPan=!1,e.isPress=!1}},{key:"cancel",value:function(t,e){clearTimeout(e.handler),e.isTap=!1,e.isPan=!1,e.isPress=!1,this.dispatcher.dispatch("cancel",{})}}]),t}();function j(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function X(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function O(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function E(t,e,n){return e&&O(t.prototype,e),n&&O(t,n),t}var A=Symbol("tick"),Y=Symbol("tick-handler"),P=Symbol("animations"),M=Symbol("start-time"),R=Symbol("pause-start"),C=Symbol("pause-time"),I=function(){function t(){X(this,t),this[P]=new Set,this[M]=new Map,this.state="inited",this.animeRunTime=0}return E(t,[{key:"add",value:function(t){this[P].add(t),this[M].set(t,Date.now()+t.delay)}},{key:"start",value:function(){var t=this;if("inited"===this.state){this.state="started";var e=Date.now();this[C]=0,this[A]=function(){var n,r=Date.now(),i=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return j(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?j(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,c=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){c=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(c)throw o}}}}(t[P]);try{for(i.s();!(n=i.n()).done;){var o=n.value,a=void 0;a=t[M].get(o)<e?r-e-t[C]-o.delay:r-t[M].get(o)-t[C]-o.delay,o.duration<a&&(t[P].delete(o),a=o.duration),t.animeRunTime=a,a>0&&o.receive(a)}}catch(t){i.e(t)}finally{i.f()}t[Y]=requestAnimationFrame(t[A])},this[A]()}}},{key:"getAnimeRunTime",value:function(){return this.animeRunTime}},{key:"pause",value:function(){"started"===this.state&&(this.state="paused",this[R]=Date.now(),this[Y]&&cancelAnimationFrame(this[Y]))}},{key:"resume",value:function(){"paused"===this.state&&(this.state="started",this[C]+=Date.now()-this[R],this[A]())}},{key:"reset",value:function(){this.pause(),this.state="inited",this.animeRunTime=0,this[C]=0,this[R]=0,this[P]=new Set,this[M]=new Map,this[Y]=null}}]),t}(),_=function(){function t(e,n,r,i,o,a,c,s){X(this,t),this.timingFunction=c||function(t){return t},this.template=s||function(t){return t},this.object=e,this.property=n,this.startVal=r,this.endVal=i,this.duration=o,this.delay=a}return E(t,[{key:"receive",value:function(t){var e=this.timingFunction(t/this.duration),n=this.endVal-this.startVal;this.object[this.property]=this.template(this.startVal+n*e)}}]),t}();function L(t,e,n,r){var i=1e-6,o=3*t-3*n+1,a=3*n-6*t,c=3*t,s=3*e-3*r+1,u=3*r-6*e,l=3*e;function f(t){return((o*t+a)*t+c)*t}return function(t){return e=function(t){for(var e,n,r,s=t,u=0;u<8;u++){if(n=f(s)-t,Math.abs(n)<i)return s;if(e=(3*o*(r=s)+2*a)*r+c,Math.abs(e)<i)break;s-=n/e}var l=1,h=0;for(s=t;l>h;){if(n=f(s)-t,Math.abs(n)<i)return s;n>0?l=s:h=s,s=(h+l)/2}return s}(t),((s*e+u)*e+l)*e;var e}}var x=L(.25,.1,.25,1);function F(t){return(F="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function V(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function D(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function U(t,e){return(U=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function B(t,e){return!e||"object"!==F(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function $(t){return($=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}L(.42,0,1,1),L(0,0,.58,1),L(.42,0,.58,1),function(t,e){var n;for(var r in n="string"==typeof t?new d(t):new t,e)n.setAttribute(r,e[r]);for(var i=function t(e){var r,i=u(e);try{for(i.s();!(r=i.n()).done;){var o=r.value;"object"!==s(o)||"[object Array]"!==Object.prototype.toString.call(o)?("string"==typeof o&&(o=new y(o)),console.log(o),n.appendChild(o)):t(o)}}catch(t){i.e(t)}finally{i.f()}},o=arguments.length,a=new Array(o>2?o-2:0),c=2;c<o;c++)a[c-2]=arguments[c];return i(a),n}(function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&U(t,e)}(a,t);var e,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=$(r);if(i){var n=$(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return B(this,t)});function a(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),o.call(this)}return e=a,(n=[{key:"render",value:function(){var t=this;this.root=document.createElement("div"),this.root.classList.add("carousel");var e,n,r=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return V(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?V(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,c=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){c=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(c)throw o}}}}(this[h].src);try{for(r.s();!(e=r.n()).done;){var i=e.value,o=document.createElement("div");o.style.backgroundImage="url(".concat(i.img,")"),this.root.appendChild(o)}}catch(t){r.e(t)}finally{r.f()}n=this.root,new S(n,new k(new T(n))),this[f].position=0;var a=this.root.children,c=new I;c.start();var s=0,u=null,l=function(){var e=t.root.children,n=(t[f].position+1)%e.length,r=e[t[f].position],i=e[n];c.add(new _(r.style,"transform",500*-t[f].position,-500-500*t[f].position,500,0,x,(function(t){return"translateX(".concat(t,"px)")}))),c.add(new _(i.style,"transform",500-500*n,500*-n,500,0,x,(function(t){return"translateX(".concat(t,"px)")}))),t[f].position=n,t.triggerEvent("change",{position:t[f].position})};return u=setInterval(l,3e3),this.root.addEventListener("start",(function(t){console.log("start"),c.pause(),clearInterval(u);var e=c.getAnimeRunTime()/500;s=500*x(e)-500})),this.root.addEventListener("tap",(function(e){t.triggerEvent("click",{data:t[h].src[t[f].position],position:t[f].position})})),this.root.addEventListener("pan",(function(e){console.log("pan");for(var n=e.clientX-e.startX-s,r=t[f].position-(n-n%500)/500,i=0,o=[-1,0,1];i<o.length;i++){var c=o[i],u=r+c;u=(u%a.length+a.length)%a.length,a[u].style.transition="none",a[u].style.transform="translateX(".concat(500*-u+500*c+n%500,"px)")}})),this.root.addEventListener("panend",(function(e){console.log("panend"),c.reset(),c.start(),u=setInterval(l,3e3);var n=e.clientX-e.startX-s,r=Math.round(n%500/500);e.isFlick&&(console.log(e.velocity),r>0?r=Math.ceil(n%500/500):r<0&&(r=Math.floor(n%500/500)));for(var i=t[f].position-(n-n%500)/500,o=0,h=[-1,0,1];o<h.length;o++){var p=h[o],d=i+p;d=(d%a.length+a.length)%a.length,a[d].style.transition="none",c.add(new _(a[d].style,"transform",500*-d+500*p+n%500,500*-d+500*p+500*r,500,0,x,(function(t){return"translateX(".concat(t,"px)")})))}t[f].position=i-r,t[f].position=(t[f].position%a.length+a.length)%a.length,t.triggerEvent("change",{position:t[f].position})})),this.root}}])&&D(e.prototype,n),a}(p),{src:[{img:"https://res.devcloud.huaweicloud.com/obsdevui/diploma/8.1.17.002/banner-8.d14241daf518717981c6.jpg",url:"https://time.geekbang.org/",title:"标题1"},{img:"https://res.devcloud.huaweicloud.com/obsdevui/diploma/8.1.17.002/banner-1.fdbf82d4c2ca7fad3225.jpg",url:"https://time.geekbang.org/",title:"标题2"},{img:"https://res.devcloud.huaweicloud.com/obsdevui/diploma/8.1.17.002/banner-2.64b1407e7a8db89d6cf2.jpg",url:"https://time.geekbang.org/",title:"标题3"},{img:"https://res.devcloud.huaweicloud.com/obsdevui/diploma/8.1.17.002/banner-3.ce76c93c7a8a149ce2a2.jpg",url:"https://time.geekbang.org/",title:"标题4"}],onChange:function(t){return console.log(t.detail.position)},onClick:function(t){return window.location.href=t.detail.data.url}}).mountTo(document.body)})();